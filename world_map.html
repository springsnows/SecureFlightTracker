<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_78596262bc831acf7a76006709329e65 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
</head>
<body>
    
    
            <div class="folium-map" id="map_78596262bc831acf7a76006709329e65" ></div>
        
</body>
<script>
    // Get initial coordinates from template variables
    // These will be populated by the server at runtime
    const initialLatitude = Number("{{ Latitude }}");
    const initialLongitude = Number("{{ Longitude }}");
    const airportLatitude = Number("{{ AirportLat }}");
    const airportLongitude = Number("{{ AirportLong }}");
    
    var map_78596262bc831acf7a76006709329e65 = L.map(
        "map_78596262bc831acf7a76006709329e65",
        {
            center: [airportLatitude, airportLongitude],
            crs: L.CRS.EPSG3857,
            zoom: 5,
            zoomControl: true,
            preferCanvas: false
        }
    );
            
    var tile_layer_0da3eee34d6f701c2dc2e0e1d2da9e60 = L.tileLayer(
        "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
        {
            minZoom: 0,
            maxZoom: 19,
            maxNativeZoom: 19,
            noWrap: false,
            attribution: "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors",
            subdomains: "abc",
            detectRetina: false,
            tms: false,
            opacity: 1
        }
    );
        
    tile_layer_0da3eee34d6f701c2dc2e0e1d2da9e60.addTo(map_78596262bc831acf7a76006709329e65);
    
    // Create plane marker
    var planeIcon = L.AwesomeMarkers.icon({
        markerColor: "blue",
        iconColor: "white",
        icon: "plane",
        prefix: "glyphicon",
        extraClasses: "fa-rotate-0"
    });
        
    var planeMarker = L.marker(
        [initialLatitude, initialLongitude],
        {icon: planeIcon}
    ).addTo(map_78596262bc831acf7a76006709329e65);
    
    planeMarker.bindPopup("Flight");
    
    // Create airport marker
    var airportIcon = L.AwesomeMarkers.icon({
        markerColor: "red",
        iconColor: "white",
        icon: "flag",
        prefix: "glyphicon"
    });
    
    var airportMarker = L.marker(
        [airportLatitude, airportLongitude],
        {icon: airportIcon}
    ).addTo(map_78596262bc831acf7a76006709329e65);
    
    airportMarker.bindPopup("Airport");
            
    // Create flight path
    var flightPath = L.polyline(
        [[initialLatitude, initialLongitude], [airportLatitude, airportLongitude]],
        {
            color: "red",
            weight: 2,
            opacity: 0.8
        }
    ).addTo(map_78596262bc831acf7a76006709329e65);
        

    // WebSocket connection
    const ws = new WebSocket(`ws://${window.location.host}/ws`);

    ws.onmessage = function(event) {
        const data = JSON.parse(event.data);
        
        // Update plane marker position
        const newLat = data.coordinates.latitude;
        const newLng = data.coordinates.longitude;
        planeMarker.setLatLng([newLat, newLng]);
        
        // Update plane marker popup with flight info
        planeMarker.bindPopup(JSON.stringify(data.flight_info));
        
        // Update flight path
        flightPath.setLatLngs([[newLat, newLng], [airportLatitude, airportLongitude]]);
        
        // Center map on plane
        map_78596262bc831acf7a76006709329e65.setView([newLat, newLng]);
    };

    ws.onerror = function(error) {
        console.error('WebSocket error:', error);
    };

    ws.onclose = function() {
        console.log('WebSocket connection closed');
    };
</script>
</html>